# 📊 株式分析システム - 詳細仕様

## 概要

本システムは、3つの先進的なAIエンジン（OpenAI、Claude、Gemini）を活用した多角的株式分析プラットフォームです。各AIに専門的な役割を割り当て、テクニカル分析、ファンダメンタル分析、総合判断を統合して提供します。

---

## 🎯 システムアーキテクチャ

### 3つのAIエンジンによる役割分担

#### 1. **Gemini 2.5 Flash** - テクニカル分析担当 📈

- **専門分野**: チャート分析、トレンド判定、テクニカル指標
- **信頼度**: 75%
- **分析内容**:
  - 現在のトレンド（上昇/下降/横ばい）
  - 移動平均線との位置関係（25日、75日、200日線）
  - サポート/レジスタンスライン
  - 出来高トレンド
  - テクニカル指標（RSI、MACD等）
- **出力**: 200文字以内の要約
- **Max Tokens**: デフォルト（Gemini API標準）

#### 2. **Claude 3.5 Sonnet** - ファンダメンタル分析担当 💼

- **専門分野**: 決算分析、財務健全性、業界動向
- **信頼度**: 85%
- **分析内容**:
  - 最新決算の状況（売上、利益、成長率）
  - 財務健全性（自己資本比率、ROE、ROA）
  - バリュエーション（PER、PBR、配当利回り）
  - 業界動向と競合比較
  - 将来性とリスク要因
- **出力**: 250文字以内の要約
- **Max Tokens**: 1000

#### 3. **OpenAI GPT-4o-mini** - 総合判断担当 ⚖️

- **専門分野**: 統合分析、投資判断、リスク評価
- **信頼度**: 80%
- **分析内容**:
  - 市場全体の環境
  - 企業の強み・弱み（SWOT的分析）
  - 短期/中期/長期の見通し
  - 投資判断（買い/売り/保留）とその根拠
  - 推奨価格レンジ
  - 注意すべきリスク要因
- **出力**: 250文字以内の要約
- **Max Tokens**: 800

---

## 🔄 分析フロー

```
1. ユーザーが銘柄コードを入力（例: 7203）
   ↓
2. 3つのAIが並列で分析を実行
   ├─ Gemini: テクニカル分析
   ├─ Claude: ファンダメンタル分析
   └─ OpenAI: 総合判断
   ↓
3. 各AIの推奨（買い/売り/保留）を集計
   ↓
4. 最終判断を生成
   - 2つ以上のAIが「買い」→ 総合判断: 買い
   - 2つ以上のAIが「売り」→ 総合判断: 売り
   - 意見が分かれている → 総合判断: 保留
   ↓
5. 統合信頼度を計算（3つのAIの信頼度の平均）
   ↓
6. 結果をユーザーに表示
```

---

## 📋 出力フォーマット

### JSON構造

```json
{
  "stockCode": "7203",
  "timestamp": "2025-10-01T14:58:29.000Z",
  "gemini": {
    "analysis": "テクニカル分析の詳細...",
    "recommendation": "買い",
    "confidence": 0.75
  },
  "claude": {
    "analysis": "ファンダメンタル分析の詳細...",
    "recommendation": "買い",
    "confidence": 0.85
  },
  "openai": {
    "analysis": "総合判断の詳細...",
    "recommendation": "保留",
    "confidence": 0.8
  },
  "finalJudgement": {
    "decision": "買い",
    "reasoning": "3つのAIのうち2つが買いを推奨しています。",
    "confidence": 0.8
  }
}
```

---

## 🎨 UI設計

### 表示順序（左から右）

1. **Gemini (緑)** - テクニカル分析
2. **Claude (紫)** - ファンダメンタル分析
3. **OpenAI (青)** - 総合判断

### カラーコーディング

- **緑 (Green)**: テクニカル分析（チャート、数値的）
- **紫 (Purple)**: ファンダメンタル分析（企業の本質的価値）
- **青 (Blue)**: 総合判断（統合的な視点）

### 総合判断バッジ

- **買い推奨**: 緑背景
- **売り推奨**: 赤背景
- **保留**: 黄色背景

---

## 🚀 今後の拡張計画

### フェーズ2: リアルタイムデータ統合（次期バージョン）

- [ ] Perplexity APIで最新ニュースを取得
- [ ] SERP APIで株価データを取得
- [ ] 取得データをプロンプトに組み込み
- [ ] 情報源と取得日時の明記

### フェーズ3: 高度な機能

- [ ] 過去の分析履歴の保存
- [ ] 複数銘柄の比較分析
- [ ] ポートフォリオ最適化の提案
- [ ] アラート機能（目標価格到達時）
- [ ] レポート生成（PDF出力）

---

## 📊 パフォーマンス指標

### 応答時間（目標）

- 並列処理により、最も遅いAIの応答時間で決定
- 通常: 5-10秒
- 最大: 15秒

### API使用コスト（概算）

- **OpenAI (GPT-4o-mini)**: ~$0.0002/リクエスト
- **Claude (3.5 Sonnet)**: ~$0.003/リクエスト
- **Gemini (2.5 Flash)**: ~$0.0001/リクエスト
- **合計**: ~$0.0033/リクエスト

---

## 🔧 設定ファイル

### 環境変数（`.env.local`）

```env
# AI API Keys
OPENAI_API_KEY=your_openai_api_key
CLAUDE_API_KEY=your_claude_api_key
GEMINI_API_KEY=your_gemini_api_key

# 今後追加予定
PERPLEXITY_API_KEY=your_perplexity_api_key
SERP_API_KEY=your_serp_api_key
```

---

## 📝 使用例

### リクエスト

```bash
POST /api/orchestrator
Content-Type: application/json

{
  "stockCode": "7203"
}
```

### レスポンス

```json
{
  "stockCode": "7203",
  "timestamp": "2025-10-01T14:58:29.000Z",
  "gemini": { ... },
  "claude": { ... },
  "openai": { ... },
  "finalJudgement": {
    "decision": "買い",
    "reasoning": "3つのAIのうち2つが買いを推奨しています。",
    "confidence": 0.80
  }
}
```

---

## 🛡️ セキュリティ

- すべてのAPIキーは環境変数で管理
- クライアント側にAPIキーは露出しない
- サーバーサイドでのみAPI呼び出しを実行
- エラーメッセージは詳細を隠蔽

---

## 📚 参考資料

- [OpenAI API Documentation](https://platform.openai.com/docs)
- [Anthropic Claude API](https://docs.anthropic.com/)
- [Google Gemini API](https://ai.google.dev/gemini-api/docs)

---

**最終更新**: 2025年10月1日  
**バージョン**: 1.0.0  
**ステータス**: ✅ 本番稼働中

